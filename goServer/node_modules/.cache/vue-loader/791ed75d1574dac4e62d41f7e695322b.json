{"remainingRequest":"/home/wushili/Desktop/myStudy/WaifuFromSketch/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/wushili/Desktop/myStudy/WaifuFromSketch/src/components/draw.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/wushili/Desktop/myStudy/WaifuFromSketch/src/components/draw.vue","mtime":1574456587991},{"path":"/home/wushili/Desktop/myStudy/WaifuFromSketch/node_modules/cache-loader/dist/cjs.js","mtime":1572924774051},{"path":"/home/wushili/Desktop/myStudy/WaifuFromSketch/node_modules/babel-loader/lib/index.js","mtime":1572924773995},{"path":"/home/wushili/Desktop/myStudy/WaifuFromSketch/node_modules/cache-loader/dist/cjs.js","mtime":1572924774051},{"path":"/home/wushili/Desktop/myStudy/WaifuFromSketch/node_modules/vue-loader/lib/index.js","mtime":1572924775515}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { Photoshop } from 'vue-color'\n// import { uploadPict } from '@/api/api'\nimport axios from 'axios'\n\nexport default {\n  name: 'draw',\n  data () {\n    return {\n      canvasSize: {\n        width: window.screen.availWidth - 320,\n        height: window.screen.availHeight * 0.4\n      },\n      canvas: this.$refs.canvas,\n      canvasTop: 67,\n      canvasLeft: 300,\n      context: null,\n      canvas_bak: this.$refs.canvas_bak,\n      context_bak: null,\n      ischoosecolor: false,\n      toolsToggle: false,\n      chooseColorBtn: '选择颜色',\n      color: {\n        hex: '#2196f3',\n        hsl: {\n          h: 205,\n          s: 86,\n          l: 0,\n          a: 1\n        },\n        hsv: {\n          h: 205,\n          s: 86,\n          v: 92,\n          a: 1\n        },\n        rgba: {\n          r: 33,\n          g: 150,\n          b: 243,\n          a: 1\n        },\n        a: 1\n      },      \n      penSize: 1,      \n      lineType: [0, 0],\n      canDraw: false,\n      curcursor: 'auto',\n      cancelList: [],\n      cancelIndex: 0,\n      tools: [{\n          name: '铅笔',\n          icon: 'mode_edit',\n          fun: 'pencil',\n          ischoose: false,\n        }, {\n          name: '直线',\n          icon: 'remove',\n          fun: 'line',\n          ischoose: false\n        }, {\n          name: '圆形',\n          icon: 'panorama_fish_eye',\n          fun: 'circle',\n          ischoose: false\n        }, {\n          name: '矩形',\n          icon: 'crop_square',\n          fun: 'square',\n          ischoose: false\n        }, {\n          name: '涂鸦',\n          icon: 'brush',\n          fun: 'handwriting',\n          ischoose: false\n        }, {\n          name: '橡皮',\n          icon: 'border_style',\n          fun: 'rubber',\n          ischoose: false\n        }],\n      tabs: [{\n          name: '清除',\n          icon: 'clear',\n          fun: 'clear'\n        }, {\n          name: '保存',\n          icon: 'system_update_alt',\n          fun: 'save'\n        }]\n    }\n  },\n  methods: {\n    initCanvas () {\n      this.canvas =  document.getElementById(\"canvas\")\n      this.canvas.width = this.canvasSize.width\n      this.canvas.height = this.canvasSize.height\n      this.context = this.canvas.getContext('2d')\n      this.canvas_bak =  document.getElementById(\"canvas_bak\")\n      this.canvas_bak.width = this.canvasSize.width\n      this.canvas_bak.height = this.canvasSize.height\n      this.context_bak = this.canvas_bak.getContext('2d')\n    },\n    setColor () {\n      this.chooseColorBtn = this.ischoosecolor ? '选择颜色':'确认选择'\n      this.ischoosecolor = this.ischoosecolor ? false : true\n    },\n    falseColor() {\n      this.ischoosecolor = false\n    },\n    drawType (pen) {\n      switch (pen.fun) {\n        case 'pencil':\n            this.curcursor = \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAZ0lEQVR4AdXOrQ2AMBRF4bMc/zOUOSrYoYI5cQQwpAieQDW3qQBO7Xebxx8bWAk5/CASmRHzRHtB+d0Bkw0W5ZiT0SYbFcl6u/2eeJHbxIHOhWO6Er6/y9syXpMul5PLefAGKZ1/rwtTimwbWLpiCgAAAABJRU5ErkJggg==') 3 24,  auto\"\n            break\n        case 'rubber':\n        this.curcursor = 'pointer'\n        break\n        case 'circle':\n        case 'square':\n        case 'line':\n        case 'handwriting':\n        this.curcursor = 'crosshair'\n        break          \n        default:\n        this.curcursor = 'auto'\n          break;\n      }  \n      this.draw_graph(pen.fun)\n      this.chooseImg(pen)\n    },\n    //选择功能按钮 修改样式\n    chooseImg(obj){\n        for (let i = 0; i < this.tools.length; i++) {\n          this.tools[i].ischoose = false\n        }\n        obj.ischoose = true        \n    },\n    tabfun(fun) {\n      if(fun === 'clear' ){\n        this.clearContext('1')\n      }else if(fun === 'save' ){\n        this.downloadImage()\n      }\n    },\n    draw_graph (graphType) {    \n        this.canvas_bak.style.zIndex = 1\n        //先画在蒙版上 再复制到画布上       \n        this.canDraw = false      \n        let startX,startY\n      //鼠标按下获取 开始xy开始画图\n        let mousedown = (e) => {\n          this.context.strokeStyle = this.color.hex\n          this.context_bak.strokeStyle = this.color.hex\n          this.context_bak.lineWidth = this.penSize\n          e=e||window.event\n          startX = e.clientX - this.canvasLeft\n          startY = e.clientY - this.canvasTop\n          this.context_bak.moveTo(startX, startY)\n          this.canDraw = true\n        if(graphType == 'pencil'){\n          this.context_bak.beginPath()\n        }else if(graphType == 'circle'){\n          this.context.beginPath()\n          this.context.moveTo(startX, startY)\n          this.context.lineTo(startX + 2, startY + 2)\n          this.context.stroke()\n        }else if(graphType == 'rubber'){\n          this.context.clearRect(startX - this.penSize * 10, startY - this.penSize * 10, this.penSize * 20, this.penSize * 20)\n        }\n      }\n      //鼠标离开 把蒙版canvas的图片生成到canvas中\n      let mouseup = (e) => {\n        e=e||window.event\n        this.canDraw = false\n        let image = new Image()\n        if (graphType!='rubber') {          \n          image.src = this.canvas_bak.toDataURL()\n          image.onload = () => {\n            this.context.drawImage(image, 0, 0, image.width, image.height, 0, 0, this.canvasSize.width, this.canvasSize.height)\n            this.clearContext()\n            this.saveImageToAry()\n          }\n          let x = e.clientX - this.canvasLeft\n          let y = e.clientY - this.canvasTop\n          this.context.beginPath()\n          this.context.moveTo(x, y)\n          this.context.lineTo(x + 2, y + 2)\n          this.context.stroke()\n        }\n      }\n      // 鼠标移动\n      let mousemove = (e) => {\n        e=e||window.event\n        let x = e.clientX - this.canvasLeft\n        let y = e.clientY - this.canvasTop\n        this.context_bak.setLineDash(this.lineType)\n        //方块  即4条直线\n        if (graphType == 'square') {\n          if (this.canDraw) {\n            this.context_bak.beginPath()\n            this.clearContext()\n            this.context_bak.moveTo(startX, startY)\n            this.context_bak.lineTo(x, startY)\n            this.context_bak.lineTo(x, y)\n            this.context_bak.lineTo(startX, y)\n            this.context_bak.lineTo(startX, startY)\n            this.context_bak.stroke()\n          }\n        //直线\n        } else if (graphType =='line' ){\n          if (this.canDraw) {\n            this.context_bak.beginPath()\n            this.clearContext()\n            this.context_bak.moveTo(startX, startY)\n            this.context_bak.lineTo(x, y)\n            this.context_bak.stroke()\n          }\n        //画笔\n        } else if (graphType == 'pencil') {\n          if (this.canDraw) {\n            this.context_bak.lineTo(e.clientX   - this.canvasLeft ,e.clientY  - this.canvasTop)\n            this.context_bak.stroke()\n          }\n        //圆 未画得时候 出现一个小圆\n        } else if (graphType == 'circle') {\n          this.clearContext()\n          if (this.canDraw) {           \n            this.context_bak.beginPath()\n            let radii = Math.sqrt((startX - x) * (startX - x)  + (startY - y) * (startY - y))\n            this.context_bak.arc(startX,startY,radii,0,Math.PI * 2,false)\n            this.context_bak.stroke()\n          } else {\n            this.context_bak.beginPath()\n            this.context_bak.arc(x, y, 20, 0, Math.PI * 2, false)\n            this.context_bak.stroke()\n          }\n        //涂鸦 未画得时候 出现一个小圆\n        } else if (graphType == 'handwriting') {\n          if (this.canDraw) {\n            this.context_bak.beginPath()\n            this.context_bak.strokeStyle = this.color.hex\n            this.context_bak.fillStyle  = this.color.hex\n            this.context_bak.arc(x, y, this.penSize*10 ,0, Math.PI * 2, false)\n            this.context_bak.fill()\n            this.context_bak.stroke()\n          } else {\n            this.clearContext()\n            this.context_bak.beginPath()\n            this.context_bak.fillStyle = this.color.hex\n            this.context_bak.arc(x, y, this.penSize*10, 0, Math.PI * 2,false)\n            this.context_bak.fill()\n            this.context_bak.stroke()\n          }\n        //橡皮擦 不管有没有在画都出现小方块 按下鼠标 开始清空区域\n        } else if (graphType == 'rubber'){\n          this.context_bak.setLineDash([0, 0])          \n          this.context_bak.lineWidth = 1\n          this.clearContext()\n          this.context_bak.beginPath()\n          this.context_bak.strokeStyle = '#000000'\n          this.context_bak.moveTo(x - this.penSize * 10,  y - this.penSize * 10 )\n          this.context_bak.lineTo(x + this.penSize * 10, y - this.penSize * 10 )\n          this.context_bak.lineTo(x + this.penSize * 10, y + this.penSize * 10 )\n          this.context_bak.lineTo(x - this.penSize * 10, y + this.penSize * 10 )\n          this.context_bak.lineTo(x - this.penSize * 10, y - this.penSize * 10 )\n          this.context_bak.stroke()\n          if (this.canDraw) {\n            this.context.clearRect(x - this.penSize * 10,  y - this.penSize * 10, this.penSize * 20, this.penSize * 20)\n          }\n          this.context_bak.setLineDash(this.lineType)\n        }\n      }\n      //鼠标离开区域以外 除了涂鸦 都清空\n      let mouseout = () => {\n        if (graphType != 'handwriting') {\n          this.clearContext()\n        }\n      }\n      this.canvas_bak.onmousedown = () => mousedown()\n      this.canvas_bak.onmousemove = () => mousemove()\n      this.canvas_bak.onmouseup = () => mouseup()\n      this.canvas_bak.onmouseout = () => mouseout()\n\n    },\n    clearContext (type) {\n      if (!type) {\n        this.context_bak.clearRect(0, 0, this.canvasSize.width, this.canvasSize.height)\n      } else {\n        this.context.clearRect(0, 0, this.canvasSize.width, this.canvasSize.height)\n        this.context_bak.clearRect(0, 0, this.canvasSize.width, this.canvasSize.height)\n      }\n    },\n    downloadImage () {\n      this.$refs.download.href = this.canvas.toDataURL()\n      // alert( this.canvas.toDataURL())\n      // this.$refs.download.click()\n      // var base64Data = this.canvas.toDataURL()\n      /*\n      var sendData = {}\n      sendData.pictData = this.canvas.toDataURL()\n      var sendJson = JSON.stringify(sendData)\n    \n      axios.post('http://drawstickserver.ngrok.io/v1/pict', sendJson).then(response=>{\n        sendJson = JSON.stringify(response.data, null, 4)\n      })*/\n      var bodyFormData = new FormData()\n      bodyFormData.append('pictData', this.canvas.toDataURL())\n      axios({\n        method: 'post',\n        url: 'http://drawstickserver.ngrok.io/v1/pict',\n        data: bodyFormData,\n        headers: {'Content-Type': 'multipart/form-data' }\n      })\n      .then(function (response) {\n        alert(response)\n      })\n      .catch(function (response) {\n        alert(response)\n      })\n      /*\n      this.$axios({\n        method: 'post',\n        url: 'http://drawstickserver.ngrok.io',\n        crossDomain: true,\n        data: sendJson\n      }).then(response=> {\n        var jsonData = JSON.stringify(response.data, null, 4);\n        this.result = jsonData\n      }).catch(function (error) {\n        this.result = 'filed!!'\n      }.bind(self))\n\n      let params = {\n        pictData: this.canvas.toDataURL()\n      }\n      uploadPict(params).then((data) => {\n        \n        alert(data)\n      })*/\n    },\n    cancel () {\n      this.cancelIndex++\n      this.context.clearRect(0, 0, this.canvasSize.width, this.canvasSize.height)\n      let image = new Image()\n      let index = this.cancelList.length-1 - this.cancelIndex\n      let url = this.cancelList[index]\n      image.src = url\n      image.onload = ()=> {\n        this.context.drawImage(image , 0, 0, image.width, image.height, 0, 0, this.canvasSize.width, this.canvasSize.height)\n      }\n    },\n    next () {\n      this.cancelIndex--\n      this.context.clearRect(0, 0, this.canvasSize.width, this.canvasSize.height)\n      let image = new Image()\n      let index = this.cancelList.length-1 - this.cancelIndex\n      let url = this.cancelList[index]\n      image.src = url\n      image.onload = () => {\n        this.context.drawImage(image, 0, 0, image.width, image.height, 0, 0, this.canvasSize.width, this.canvasSize.height)\n      }\n    },\n    //保存历史 用于撤销\n    saveImageToAry () {\n      this.cancelIndex = 0\n      let dataUrl =  this.canvas.toDataURL()\n      this.cancelList.push(dataUrl)   \n    },\n    // 处理文件拖入事件，防止浏览器默认事件带来的重定向  \n    handleDragOver (evt) {  \n      evt.stopPropagation()\n      evt.preventDefault()\n    },\n    isImage (type) {  \n      switch (type) {        \n      case 'image/jpeg':\n      case 'image/png':\n      case 'image/gif':\n      case 'image/bmp':\n      case 'image/jpg':\n        return true\n      default:\n        return false\n      }  \n    },\n    // 处理拖放文件列表  \n    handleFileSelect (evt) {\n      evt.stopPropagation()\n      evt.preventDefault()\n      let files = evt.dataTransfer.files\n      for (let i = 0, f; (f = files[i]); i++) {\n        let t = f.type ? f.type : 'n/a'\n        let reader = new FileReader()\n        let isImg = this.isImage(t)\n        // 处理得到的图片\n        if (isImg) {\n          reader.onload = (() =>  {\n            return (e) => {\n              let  image = new Image()\n              image.src =  e.target.result\n              image.onload = ()=> {\n                this.context.drawImage(image, 0, 0, image.width, image.height, 0, 0, this.canvasSize.width, this.canvasSize.height)\n              }\n            }\n          })(f)\n          reader.readAsDataURL(f)\n        }\n      }\n    },\n     //初始化拖入效果\n    initDrag () {\n      let dragDiv  = document.getElementById(\"canvas_bak\")\n      dragDiv.addEventListener('dragover', this.handleDragOver, false) \n      dragDiv.addEventListener('drop', this.handleFileSelect, false)\n    },\n    addkeyBoardlistener () {\n      document.onkeydown = (event) => {   \n        let e = event || window.event || arguments.callee.caller.arguments[0]\n        if (e.keyCode === 89 && e.ctrlKey) {\n          //ctrl+Y\n          this.next()\n        }\n        if (e.keyCode === 90 && e.ctrlKey) {\n          // ctrl+Z\n          this.cancel()\n        }\n      }\n    }\n  },\n  components: {\n    'PhotoshopPicker': Photoshop\n  },\n  mounted () {\n    this.initCanvas()\n    this.initDrag()\n    this.addkeyBoardlistener()\n    this.drawType(this.tools[0])\n    this.canvas_bak.addEventListener('click', this.falseColor)\n    window.addEventListener('resize', () => {\n      this.canvasSize = {\n        width: window.screen.availWidth - 320,\n        height: window.screen.availHeight * 0.75\n      }\n    })\n  }\n}\n",{"version":3,"sources":["draw.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"draw.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"layout\">\n    <div class=\"header\">      \n      <div class=\"logo\">\n        <span>Drawing</span>\n        </div>\n      <div class=\"nav\">\n        <mu-flat-button v-for=\"tab in tabs\" :key=\"tab.name\" :label=\"tab.name\" class=\"tab demo-flat-button\" :icon=\"tab.icon\" @click=\"tabfun(tab.fun)\"  primary backgroundColor=\"#FFFFFF\"/>\n        <mu-flat-button :label=\"chooseColorBtn\" class=\"tab demo-flat-button\" icon=\"color_lens\" @click=\"setColor()\"  primary backgroundColor=\"#FFFFFF\" :color=\"color.hex\"/>\n        <a href=\"javascript:void(0);\" ref=\"download\" download=\"picture.png\" v-show=\"false\"></a>        \n      </div>\n      <PhotoshopPicker v-model=\"color\" v-if=\"ischoosecolor\" style=\"position:absolute;z-index:10;top:56px;\" @ok=\"setColor()\" @cancel=\"falseColor()\"/>\n    </div>\n    <div class=\"content\">\n      <div class=\"content-left\">\n        <div class=\"setterSize\">\n          <span>线条粗细:{{penSize}}</span>\n          <mu-slider v-model=\"penSize\" :step=\"1\" :max=\"30\"/>\n          <span>虚线长度:{{lineType[0]}}</span>\n          <mu-slider v-model=\"lineType[0]\" :step=\"1\" :max=\"100\"/>\n          <span>虚线间距:{{lineType[1]}}</span>\n          <mu-slider v-model=\"lineType[1]\" :step=\"1\" :max=\"100\"/> \n        </div>\n        <mu-paper>\n          <mu-menu v-for=\"tool in tools\" :key=\"tool.name\">\n            <mu-menu-item :title=\"tool.name\" :leftIcon=\"tool.icon\" @click=\"drawType(tool)\" :class=\"{'selected':tool.ischoose}\"/>\n          </mu-menu>\n        </mu-paper>        \n      </div>\n      <div class=\"content-right\">\n        <div class=\"body\" :style=\"{width:canvasSize.width + 'px',height: canvasSize.height + 'px' }\">\n            <canvas id=\"canvas\" ref=\"canvas\" :style=\"{cursor:curcursor}\"></canvas>\n            <canvas id=\"canvas_bak\" ref=\"canvas_bak\" :style=\"{cursor:curcursor}\"></canvas>\n        </div>\n        <div style=\"display:flex; flex-direction: row; flex-grow: 1\">\n          <div style=\"display:flex; flex-direction: column; flex-grow: 1\">\n            <h3>input</h3>\n            <img width=\"80%\" height=\"60%\" src=\"../../input/1.png\" />\n          </div>\n          <div style=\"display:flex; flex-direction: column; flex-grow: 1\">\n            <h3>output</h3>\n            <img width=\"80%\" height=\"60%\" src=\"../../output/1.png\" />\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { Photoshop } from 'vue-color'\n// import { uploadPict } from '@/api/api'\nimport axios from 'axios'\n\nexport default {\n  name: 'draw',\n  data () {\n    return {\n      canvasSize: {\n        width: window.screen.availWidth - 320,\n        height: window.screen.availHeight * 0.4\n      },\n      canvas: this.$refs.canvas,\n      canvasTop: 67,\n      canvasLeft: 300,\n      context: null,\n      canvas_bak: this.$refs.canvas_bak,\n      context_bak: null,\n      ischoosecolor: false,\n      toolsToggle: false,\n      chooseColorBtn: '选择颜色',\n      color: {\n        hex: '#2196f3',\n        hsl: {\n          h: 205,\n          s: 86,\n          l: 0,\n          a: 1\n        },\n        hsv: {\n          h: 205,\n          s: 86,\n          v: 92,\n          a: 1\n        },\n        rgba: {\n          r: 33,\n          g: 150,\n          b: 243,\n          a: 1\n        },\n        a: 1\n      },      \n      penSize: 1,      \n      lineType: [0, 0],\n      canDraw: false,\n      curcursor: 'auto',\n      cancelList: [],\n      cancelIndex: 0,\n      tools: [{\n          name: '铅笔',\n          icon: 'mode_edit',\n          fun: 'pencil',\n          ischoose: false,\n        }, {\n          name: '直线',\n          icon: 'remove',\n          fun: 'line',\n          ischoose: false\n        }, {\n          name: '圆形',\n          icon: 'panorama_fish_eye',\n          fun: 'circle',\n          ischoose: false\n        }, {\n          name: '矩形',\n          icon: 'crop_square',\n          fun: 'square',\n          ischoose: false\n        }, {\n          name: '涂鸦',\n          icon: 'brush',\n          fun: 'handwriting',\n          ischoose: false\n        }, {\n          name: '橡皮',\n          icon: 'border_style',\n          fun: 'rubber',\n          ischoose: false\n        }],\n      tabs: [{\n          name: '清除',\n          icon: 'clear',\n          fun: 'clear'\n        }, {\n          name: '保存',\n          icon: 'system_update_alt',\n          fun: 'save'\n        }]\n    }\n  },\n  methods: {\n    initCanvas () {\n      this.canvas =  document.getElementById(\"canvas\")\n      this.canvas.width = this.canvasSize.width\n      this.canvas.height = this.canvasSize.height\n      this.context = this.canvas.getContext('2d')\n      this.canvas_bak =  document.getElementById(\"canvas_bak\")\n      this.canvas_bak.width = this.canvasSize.width\n      this.canvas_bak.height = this.canvasSize.height\n      this.context_bak = this.canvas_bak.getContext('2d')\n    },\n    setColor () {\n      this.chooseColorBtn = this.ischoosecolor ? '选择颜色':'确认选择'\n      this.ischoosecolor = this.ischoosecolor ? false : true\n    },\n    falseColor() {\n      this.ischoosecolor = false\n    },\n    drawType (pen) {\n      switch (pen.fun) {\n        case 'pencil':\n            this.curcursor = \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAQAAABKfvVzAAAAZ0lEQVR4AdXOrQ2AMBRF4bMc/zOUOSrYoYI5cQQwpAieQDW3qQBO7Xebxx8bWAk5/CASmRHzRHtB+d0Bkw0W5ZiT0SYbFcl6u/2eeJHbxIHOhWO6Er6/y9syXpMul5PLefAGKZ1/rwtTimwbWLpiCgAAAABJRU5ErkJggg==') 3 24,  auto\"\n            break\n        case 'rubber':\n        this.curcursor = 'pointer'\n        break\n        case 'circle':\n        case 'square':\n        case 'line':\n        case 'handwriting':\n        this.curcursor = 'crosshair'\n        break          \n        default:\n        this.curcursor = 'auto'\n          break;\n      }  \n      this.draw_graph(pen.fun)\n      this.chooseImg(pen)\n    },\n    //选择功能按钮 修改样式\n    chooseImg(obj){\n        for (let i = 0; i < this.tools.length; i++) {\n          this.tools[i].ischoose = false\n        }\n        obj.ischoose = true        \n    },\n    tabfun(fun) {\n      if(fun === 'clear' ){\n        this.clearContext('1')\n      }else if(fun === 'save' ){\n        this.downloadImage()\n      }\n    },\n    draw_graph (graphType) {    \n        this.canvas_bak.style.zIndex = 1\n        //先画在蒙版上 再复制到画布上       \n        this.canDraw = false      \n        let startX,startY\n      //鼠标按下获取 开始xy开始画图\n        let mousedown = (e) => {\n          this.context.strokeStyle = this.color.hex\n          this.context_bak.strokeStyle = this.color.hex\n          this.context_bak.lineWidth = this.penSize\n          e=e||window.event\n          startX = e.clientX - this.canvasLeft\n          startY = e.clientY - this.canvasTop\n          this.context_bak.moveTo(startX, startY)\n          this.canDraw = true\n        if(graphType == 'pencil'){\n          this.context_bak.beginPath()\n        }else if(graphType == 'circle'){\n          this.context.beginPath()\n          this.context.moveTo(startX, startY)\n          this.context.lineTo(startX + 2, startY + 2)\n          this.context.stroke()\n        }else if(graphType == 'rubber'){\n          this.context.clearRect(startX - this.penSize * 10, startY - this.penSize * 10, this.penSize * 20, this.penSize * 20)\n        }\n      }\n      //鼠标离开 把蒙版canvas的图片生成到canvas中\n      let mouseup = (e) => {\n        e=e||window.event\n        this.canDraw = false\n        let image = new Image()\n        if (graphType!='rubber') {          \n          image.src = this.canvas_bak.toDataURL()\n          image.onload = () => {\n            this.context.drawImage(image, 0, 0, image.width, image.height, 0, 0, this.canvasSize.width, this.canvasSize.height)\n            this.clearContext()\n            this.saveImageToAry()\n          }\n          let x = e.clientX - this.canvasLeft\n          let y = e.clientY - this.canvasTop\n          this.context.beginPath()\n          this.context.moveTo(x, y)\n          this.context.lineTo(x + 2, y + 2)\n          this.context.stroke()\n        }\n      }\n      // 鼠标移动\n      let mousemove = (e) => {\n        e=e||window.event\n        let x = e.clientX - this.canvasLeft\n        let y = e.clientY - this.canvasTop\n        this.context_bak.setLineDash(this.lineType)\n        //方块  即4条直线\n        if (graphType == 'square') {\n          if (this.canDraw) {\n            this.context_bak.beginPath()\n            this.clearContext()\n            this.context_bak.moveTo(startX, startY)\n            this.context_bak.lineTo(x, startY)\n            this.context_bak.lineTo(x, y)\n            this.context_bak.lineTo(startX, y)\n            this.context_bak.lineTo(startX, startY)\n            this.context_bak.stroke()\n          }\n        //直线\n        } else if (graphType =='line' ){\n          if (this.canDraw) {\n            this.context_bak.beginPath()\n            this.clearContext()\n            this.context_bak.moveTo(startX, startY)\n            this.context_bak.lineTo(x, y)\n            this.context_bak.stroke()\n          }\n        //画笔\n        } else if (graphType == 'pencil') {\n          if (this.canDraw) {\n            this.context_bak.lineTo(e.clientX   - this.canvasLeft ,e.clientY  - this.canvasTop)\n            this.context_bak.stroke()\n          }\n        //圆 未画得时候 出现一个小圆\n        } else if (graphType == 'circle') {\n          this.clearContext()\n          if (this.canDraw) {           \n            this.context_bak.beginPath()\n            let radii = Math.sqrt((startX - x) * (startX - x)  + (startY - y) * (startY - y))\n            this.context_bak.arc(startX,startY,radii,0,Math.PI * 2,false)\n            this.context_bak.stroke()\n          } else {\n            this.context_bak.beginPath()\n            this.context_bak.arc(x, y, 20, 0, Math.PI * 2, false)\n            this.context_bak.stroke()\n          }\n        //涂鸦 未画得时候 出现一个小圆\n        } else if (graphType == 'handwriting') {\n          if (this.canDraw) {\n            this.context_bak.beginPath()\n            this.context_bak.strokeStyle = this.color.hex\n            this.context_bak.fillStyle  = this.color.hex\n            this.context_bak.arc(x, y, this.penSize*10 ,0, Math.PI * 2, false)\n            this.context_bak.fill()\n            this.context_bak.stroke()\n          } else {\n            this.clearContext()\n            this.context_bak.beginPath()\n            this.context_bak.fillStyle = this.color.hex\n            this.context_bak.arc(x, y, this.penSize*10, 0, Math.PI * 2,false)\n            this.context_bak.fill()\n            this.context_bak.stroke()\n          }\n        //橡皮擦 不管有没有在画都出现小方块 按下鼠标 开始清空区域\n        } else if (graphType == 'rubber'){\n          this.context_bak.setLineDash([0, 0])          \n          this.context_bak.lineWidth = 1\n          this.clearContext()\n          this.context_bak.beginPath()\n          this.context_bak.strokeStyle = '#000000'\n          this.context_bak.moveTo(x - this.penSize * 10,  y - this.penSize * 10 )\n          this.context_bak.lineTo(x + this.penSize * 10, y - this.penSize * 10 )\n          this.context_bak.lineTo(x + this.penSize * 10, y + this.penSize * 10 )\n          this.context_bak.lineTo(x - this.penSize * 10, y + this.penSize * 10 )\n          this.context_bak.lineTo(x - this.penSize * 10, y - this.penSize * 10 )\n          this.context_bak.stroke()\n          if (this.canDraw) {\n            this.context.clearRect(x - this.penSize * 10,  y - this.penSize * 10, this.penSize * 20, this.penSize * 20)\n          }\n          this.context_bak.setLineDash(this.lineType)\n        }\n      }\n      //鼠标离开区域以外 除了涂鸦 都清空\n      let mouseout = () => {\n        if (graphType != 'handwriting') {\n          this.clearContext()\n        }\n      }\n      this.canvas_bak.onmousedown = () => mousedown()\n      this.canvas_bak.onmousemove = () => mousemove()\n      this.canvas_bak.onmouseup = () => mouseup()\n      this.canvas_bak.onmouseout = () => mouseout()\n\n    },\n    clearContext (type) {\n      if (!type) {\n        this.context_bak.clearRect(0, 0, this.canvasSize.width, this.canvasSize.height)\n      } else {\n        this.context.clearRect(0, 0, this.canvasSize.width, this.canvasSize.height)\n        this.context_bak.clearRect(0, 0, this.canvasSize.width, this.canvasSize.height)\n      }\n    },\n    downloadImage () {\n      this.$refs.download.href = this.canvas.toDataURL()\n      // alert( this.canvas.toDataURL())\n      // this.$refs.download.click()\n      // var base64Data = this.canvas.toDataURL()\n      /*\n      var sendData = {}\n      sendData.pictData = this.canvas.toDataURL()\n      var sendJson = JSON.stringify(sendData)\n    \n      axios.post('http://drawstickserver.ngrok.io/v1/pict', sendJson).then(response=>{\n        sendJson = JSON.stringify(response.data, null, 4)\n      })*/\n      var bodyFormData = new FormData()\n      bodyFormData.append('pictData', this.canvas.toDataURL())\n      axios({\n        method: 'post',\n        url: 'http://drawstickserver.ngrok.io/v1/pict',\n        data: bodyFormData,\n        headers: {'Content-Type': 'multipart/form-data' }\n      })\n      .then(function (response) {\n        alert(response)\n      })\n      .catch(function (response) {\n        alert(response)\n      })\n      /*\n      this.$axios({\n        method: 'post',\n        url: 'http://drawstickserver.ngrok.io',\n        crossDomain: true,\n        data: sendJson\n      }).then(response=> {\n        var jsonData = JSON.stringify(response.data, null, 4);\n        this.result = jsonData\n      }).catch(function (error) {\n        this.result = 'filed!!'\n      }.bind(self))\n\n      let params = {\n        pictData: this.canvas.toDataURL()\n      }\n      uploadPict(params).then((data) => {\n        \n        alert(data)\n      })*/\n    },\n    cancel () {\n      this.cancelIndex++\n      this.context.clearRect(0, 0, this.canvasSize.width, this.canvasSize.height)\n      let image = new Image()\n      let index = this.cancelList.length-1 - this.cancelIndex\n      let url = this.cancelList[index]\n      image.src = url\n      image.onload = ()=> {\n        this.context.drawImage(image , 0, 0, image.width, image.height, 0, 0, this.canvasSize.width, this.canvasSize.height)\n      }\n    },\n    next () {\n      this.cancelIndex--\n      this.context.clearRect(0, 0, this.canvasSize.width, this.canvasSize.height)\n      let image = new Image()\n      let index = this.cancelList.length-1 - this.cancelIndex\n      let url = this.cancelList[index]\n      image.src = url\n      image.onload = () => {\n        this.context.drawImage(image, 0, 0, image.width, image.height, 0, 0, this.canvasSize.width, this.canvasSize.height)\n      }\n    },\n    //保存历史 用于撤销\n    saveImageToAry () {\n      this.cancelIndex = 0\n      let dataUrl =  this.canvas.toDataURL()\n      this.cancelList.push(dataUrl)   \n    },\n    // 处理文件拖入事件，防止浏览器默认事件带来的重定向  \n    handleDragOver (evt) {  \n      evt.stopPropagation()\n      evt.preventDefault()\n    },\n    isImage (type) {  \n      switch (type) {        \n      case 'image/jpeg':\n      case 'image/png':\n      case 'image/gif':\n      case 'image/bmp':\n      case 'image/jpg':\n        return true\n      default:\n        return false\n      }  \n    },\n    // 处理拖放文件列表  \n    handleFileSelect (evt) {\n      evt.stopPropagation()\n      evt.preventDefault()\n      let files = evt.dataTransfer.files\n      for (let i = 0, f; (f = files[i]); i++) {\n        let t = f.type ? f.type : 'n/a'\n        let reader = new FileReader()\n        let isImg = this.isImage(t)\n        // 处理得到的图片\n        if (isImg) {\n          reader.onload = (() =>  {\n            return (e) => {\n              let  image = new Image()\n              image.src =  e.target.result\n              image.onload = ()=> {\n                this.context.drawImage(image, 0, 0, image.width, image.height, 0, 0, this.canvasSize.width, this.canvasSize.height)\n              }\n            }\n          })(f)\n          reader.readAsDataURL(f)\n        }\n      }\n    },\n     //初始化拖入效果\n    initDrag () {\n      let dragDiv  = document.getElementById(\"canvas_bak\")\n      dragDiv.addEventListener('dragover', this.handleDragOver, false) \n      dragDiv.addEventListener('drop', this.handleFileSelect, false)\n    },\n    addkeyBoardlistener () {\n      document.onkeydown = (event) => {   \n        let e = event || window.event || arguments.callee.caller.arguments[0]\n        if (e.keyCode === 89 && e.ctrlKey) {\n          //ctrl+Y\n          this.next()\n        }\n        if (e.keyCode === 90 && e.ctrlKey) {\n          // ctrl+Z\n          this.cancel()\n        }\n      }\n    }\n  },\n  components: {\n    'PhotoshopPicker': Photoshop\n  },\n  mounted () {\n    this.initCanvas()\n    this.initDrag()\n    this.addkeyBoardlistener()\n    this.drawType(this.tools[0])\n    this.canvas_bak.addEventListener('click', this.falseColor)\n    window.addEventListener('resize', () => {\n      this.canvasSize = {\n        width: window.screen.availWidth - 320,\n        height: window.screen.availHeight * 0.75\n      }\n    })\n  }\n}\n</script>\n<style scoped>\n* {\n  -webkit-user-select: none;\n  -moz-user-select: none; \n  -ms-user-select: none; \n  user-select: none;\n}\n\ncanvas {\n  position: absolute;\n  z-index : 0;\n  left: 0;\n  right: 0;\n  width: 100%;\n  height:100%;  \n}\n\n.layout {\n  background-color: rgb(236, 236, 236);\n  height: 100%;\n}\n\n.header {\n  background-color: #2196f3;\n  position: relative;\n  display: flex;\n  align-items: center;\n}\n\n.logo {\n  display: flex;\n  align-items: center;\n  font-size: 24px;\n  color: white;\n  padding: 10px 20px;\n}\n\n.nav {\n  display: flex;\n  width: calc(100% - 150px);\n  margin: 0 auto;\n}\n\n.content {\n  overflow: hidden;\n  width: 100%;\n  height: calc(100vh - 56px);\n  display: flex;\n}\n\n.content-left {\n  width: 280px;\n  background-color: white;\n}\n\n.content-right {\n  width: calc(100% - 280px);\n  height: 100%;\n  padding: 10px 20px;\n  background-color: rgba(0, 0, 0, 0)\n}\n\n.body {\n  position: relative;\n  background-color: white;\n  border-radius: 5px;\n  height:100%;\n  margin: 0 auto;\n}\n\n.setterSize {\n  padding: 5%;\n  font-size: 0.5rem;\n}\n\n.selected {\n  background: rgba(0,0,0,0.35)!important;\n}\n\n.tab {\n  margin-right: 5px\n}\n</style>"]}]}